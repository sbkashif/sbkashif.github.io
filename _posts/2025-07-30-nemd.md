---
layout: post
title: 'Built for equilibrium but tasked with steady-state: How theoretical foundations of molecular dynamics survive'
permalink: _posts/:year/:month/:day/:title/
tags: [molecular dynamics, non-equilibrium, steady-state, ergodic hypothesis]
usemathjax: true
ai_assistants:
  - tool: perplexity
    url: https://www.perplexity.ai/search/can-you-explain-the-concept-of-NMw649bBSVCBrFkSsI7Iyg#30
  - tool: chatgpt
    url: https://chatgpt.com/share/680160d1-905c-8000-9349-a7c00de3d16b
---

Molecular dynamics (MD) simulations are built on the ergodic hypothesis and the principles of equilibrium statistical mechanics. But many real-world processes—like water flow through a membrane—are inherently non-equilibrium and steady-state. So, how can MD, designed for equilibrium, provide reliable predictions for these situations? In this post, we will discuss the validity of these approaches. 

Let's start with reviewing the core principles of MD and equilibrium statistical mechanics, then see how they apply to non-equilibrium steady states.
<!--more-->
## Equations of Motion: The MD engine
MD uses Newton’s laws of motion to simulate how atoms and molecules move over time:

$$F = ma \quad \text{or in MD form:} \quad \frac{d\mathbf{q}}{dt} = \frac{\partial H}{\partial \mathbf{p}}, \quad \frac{d\mathbf{p}}{dt} = -\frac{\partial H}{\partial \mathbf{q}}$$

Here, $$\mathbf{q}$$ and $$\mathbf{p}$$ are positions and momenta, and $$H$$ is the Hamiltonian — the total energy of the system.

This microscopic, deterministic evolution shows where every atom moves at every instant. But, with billions of particles, the detailed motion is impossibly complex to track or interpret directly. So how do we extract familiar, macroscopic properties—like temperature, pressure, or particle flux—from this chaos?

The answer comes from statistical mechanics, which tells us how to relate the microscopic “movie” to emergent, reproducible behaviors. But for statistical mechanics to supply reliable predictions, the way systems explore possible states—their phase space—must obey certain rules.

## Equilibrium: The Key to Reliable Predictions

MD assumes equilibrium. First, let us review what equilibrium means in this context.

**Thermodynamic equilibrium** is a state where macroscopic properties — like temperature, pressure, and chemical potential — remain stable in time and uniform in space. Molecules still move, and chemical reactions can still occur, but **there is no net change** in state variables. For example, in a chemical reaction at equilibrium, the forward and reverse reactions occur at the **same rate** — a concept known as **detailed balance**. Similarly, energy and particles can move around, but there are no **net flows**. At the molecular level, this means that while individual particles fluctuate, the overall probability distribution of microstates is stationary and dictated by statistical mechanics.

In contrast, a **steady state** also has stable macroscopic properties over time, but it may involve continuous **net flows** of energy or matter. The key is that **inflows equal outflows** so the system doesn’t accumulate or lose anything over time. However, **detailed balance is broken** — processes can be directionally biased.

For example, in reverse osmosis, water molecules flow from high to low concentration through a membrane, driven by an external pressure gradient. The system is not at equilibrium because there is a net flow of water, but it can still reach a steady state where properties like density and flux stabilize.

### The Boltzmann Distribution: Probability at Equilibrium

At equilibrium, the probability of finding the system in any microscopic state is set by the Boltzmann distribution:
$$ P(\mathbf{q}, \mathbf{p}) = \frac{1}{Z} e^{-\beta H(\mathbf{q}, \mathbf{p})} $$

where $$Z$$ is the partition function, $$\beta = \frac{1}{k_B T}$$, and $$k_B$$ is Boltzmann’s constant. 

Equilibrium: The key point here is that this distribution is stationary—it doesn’t change over time. Even as individual molecules fly about, the overall statistical “recipe” for the system’s state remains constant, which is why we can trust MD predictions under equilibrium conditions.

### Liouville’s Theorem: Phase-space preservation

But why doesn’t the probability distribution get distorted as the simulation runs? Imagine running thousands of slightly different MD simulations at once — each with a tiny variation in the initial positions or velocities of atoms. This collection of possible states forms a cloud in phase space (the space of all possible positions and momenta).

Liouville’s theorem states that the phase-space volume occupied by these states remains constant as they evolve:

$$ \frac{d\rho}{dt} = 0 \quad \text{along a trajectory} $$

where $\rho(\mathbf{q}, \mathbf{p}, t)$ is the probability density in phase space.

A helpful analogy: Think of kneading dough. You can stretch, fold, or twist it — but you’re not changing its total volume. Phase space behaves the same. This means the **probability density doesn’t get distorted** by time evolution.

That’s important, because it means the probability distribution of states is preserved. If your system starts with a certain distribution of energies or positions, that distribution won’t drift or get distorted as you run the simulation. This underpins our use of statistical ensembles and gives confidence our MD simulation correctly samples the space of possibilities… if phase space is explored sufficiently.

### The Ergodic Hypothesis and chaos: One trajectory is enough

How do you ensure one simulation samples sufficiently widely, instead of getting stuck? The ergodic hypothesis provides the answer:

- If you simulate a system long enough, it will visit all the relevant parts of its phase space.
- The time average of a quantity (like energy or density) becomes equal to the ensemble average over many systems:

$$ 
\langle A \rangle_{\text{ensemble}} = \lim_{\tau \to \infty} \frac{1}{\tau} \int_0^{\tau} A(t) \, dt 
$$

Liouville’s theorem guarantees that the phase-space volume is preserved along trajectories, but to extract meaningful averages, the system’s trajectory must explore phase space thoroughly. This exploration comes from **ergodicity**, enabled by **chaotic dynamics**.

One way to quantify chaos is through the **Lyapunov exponent**:

$$ 
\lambda = \lim_{t \to \infty} \frac{1}{t} \ln\left(\frac{\delta(t)}{\delta_0}\right) 
$$

where \( \delta(t) \) and \( \delta_0 \) are the separations between two trajectories at time \( t \) and initially, respectively.

In practice, positive Lyapunov exponents ensure that initial condition details do not bias long-term simulation results, acting like a mixing spoon to guarantee the system samples its accessible phase space efficiently.

### Detailed Balance: The Signature of Equilibrium

Hidden at the heart of equilibrium is the principle of detailed balance. It’s the idea that, on a microscopic level, every process is matched by its reverse at exactly the same rate. 

Mathematially, for any two microscopic states  \( i \) and \( j \):
$$ P_\text{eq}(i) W_{ij} = P_\text{eq}(j) W_{ji} $$

where \( P_\text{eq} \) is the equilibrium probability distribution and \( W_{ij} \) is the transition rate from state \( i \) to state \( j \).   

Imagine a molecular “turnstile”—for every particle crossing from left to right, another heads right to left, perfectly balancing the books. One nice visualization of detailed balance is available [here](https://x.com/keenanisalive/status/1857104230856941905) (Credits to @keenanisalive).

Detailed balance ensures there are no net currents at equilibrium. It’s this invisible equilibrium bookkeeping that lets us rest easy, knowing our time-averaged observations reflect the natural probabilities of system configurations.

## The Paradox: MD Needs Equilibrium — But We Want to Simulate Flow!

Molecular dynamics (MD) fundamentally relies on equilibrium principles such as detailed balance and ergodicity, which ensure that microscopic configurations are sampled thoroughly and that the resulting statistics reliably reflect macroscopic thermodynamic behavior.

However, many real-world phenomena—like reverse osmosis, driven by pressure gradients—are fundamentally non-equilibrium. These processes feature steady-state flows where two key assumptions of equilibrium break down:
1. **Detailed balance is broken**: There are net flows of particles or energy, so the forward and reverse processes do not balance out.
$$\sum_j W_{ij} P_i \neq \sum_j W_{ji} P_j$$
2. The Boltzmann distribution is no longer sampled: The probability distribution the system samples from is no longer the familiar equilibrium form. 
$$P \neq \frac{1}{Z} e^{-\beta H}$$

Instead, the system settles into a new, steady-state distribution that depends on the ongoing flows and driving forces.


Despite this, much of the other foundations of MD survives:
- **Liouville’s theorem** continues to hold because Newtonian (Hamiltonian) dynamics remain unchanged, so phase-space volume is conserved.
- **Lyapunov exponents** remain positive, signaling ongoing chaos and ensuring the system does not languish in a narrow subset of states but continues exploring its accessible phase space.
- **Ergodicity and mixing** can still hold: as long as the system is chaotic and mixing well, time averages computed in simulation remain meaningful, now reflecting the new steady-state distribution rather than the equilibrium one.

How do we reconcile these changes? The key is to shift focus: instead of assuming the system samples from equilibrium (Boltzmann) distributions governed by detailed balance, we embrace the fact that under steady, ongoing driving, the simulation explores a **non-equilibrium steady-state (NESS) distribution**. This distribution is stationary—its statistical properties do not change over time, even though detailed balance and Boltzmann statistics no longer apply:


$$ \delta P_{NESS}/dt = 0 $$

meaning statistical properties do not change with time, allowing stable, reproducible averages to be computed.

For example, in reverse osmosis, water driven across a membrane no longer obeys detailed balance or the equilibrium distribution: the forward flux of water exceeds the backward rate, creating a persistent flux, **J**.

But this flux, J, stabilizes at a constant value over time, marking the system’s attainment of a non-equilibrium steady state. Achieving this steady state signifies that the microscopic dynamics have thoroughly “mixed” the system under the sustained driving conditions, preserving ergodic behavior despite the continuous external forcing. In other words, the system continues to robustly explore its accessible phase space—chaotic dynamics remain active, as reflected by positive Lyapunov exponents—and the probability distribution over states becomes stationary (time-invariant), although it no longer corresponds to equilibrium.

This persistent mixing and ergodicity ensure that time averages of observables, such as flux, converge to stable, physically meaningful values. As a result, even far from equilibrium, one can confidently analyze such steady fluxes to extract fundamental transport properties—like permeability or diffusion coefficients—with the same rigorous reliability rooted in the core theoretical framework of molecular dynamics.

## Conclusion: MD’s Foundations in Non-Equilibrium

But this flux, J, stabilizes at a constant value over time, marking the system’s attainment of a non-equilibrium steady state. Achieving this steady state signifies that the microscopic dynamics have thoroughly “mixed” the system under the sustained driving conditions, preserving ergodic behavior despite the continuous external forcing. In other words, the system continues to robustly explore its accessible phase space—chaotic dynamics remain active, as reflected by positive Lyapunov exponents—and the probability distribution over states becomes stationary (time-invariant), although it no longer corresponds to equilibrium.

This persistent mixing and ergodicity ensure that time averages of observables, such as flux, converge to stable, physically meaningful values. As a result, even far from equilibrium, one can confidently analyze such steady fluxes to extract fundamental transport properties—like permeability or diffusion coefficients—with the same rigorous reliability rooted in the core theoretical framework of molecular dynamics.